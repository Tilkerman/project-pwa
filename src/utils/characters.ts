import type { Character, CharacterType, Habit } from '@/types'

export const characters: Record<CharacterType, Character> = {
  babushka: {
    id: 'babushka',
    name: 'Ð”Ð¾Ð±Ñ€Ð°Ñ Ð‘Ð°Ð±ÑƒÑˆÐºÐ°',
    icon: 'ðŸ‘µ',
    phrases: {
      daily: [
        'Ð”Ð¾Ñ€Ð¾Ð³Ð¾Ð¹ Ð¼Ð¾Ð¹, ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ñ‹ Ð¼Ð¾Ð»Ð¾Ð´ÐµÑ†! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ð´ÑƒÑ…Ðµ!',
        'Ð’Ð½ÑƒÑ‡ÐµÐº, Ñ Ñ‚Ð°Ðº Ð³Ð¾Ñ€Ð¶ÑƒÑÑŒ Ñ‚Ð¾Ð±Ð¾Ð¹! ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð±ÐµÐ· ÑÑ‚Ð¾Ð¹ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸ - ÑÑ‚Ð¾ Ð¿Ð¾Ð±ÐµÐ´Ð°!',
        'Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾, Ñ€Ð¾Ð´Ð½Ð¾Ð¹! Ð‘Ð°Ð±ÑƒÑˆÐºÐ° Ð²ÐµÑ€Ð¸Ñ‚ Ð² Ñ‚ÐµÐ±Ñ!',
        'ÐšÐ°ÐºÐ¾Ð¹ Ñ‚Ñ‹ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¹! Ð¯ Ð·Ð½Ð°Ð»Ð°, Ñ‡Ñ‚Ð¾ Ñƒ Ñ‚ÐµÐ±Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑÑ!',
        'ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹, ÑÐ¾Ð»Ð½Ñ‹ÑˆÐºÐ¾! Ð¢Ñ‹ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ð¿ÑƒÑ‚Ð¸!'
      ],
      milestones: {
        1: [
          'ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ - ÑÑ‚Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð³Ð¾ Ð¿ÑƒÑ‚Ð¸! Ð“Ð¾Ñ€Ð¶ÑƒÑÑŒ Ñ‚Ð¾Ð±Ð¾Ð¹, Ð²Ð½ÑƒÑ‡ÐµÐº!',
          'ÐŸÐµÑ€Ð²Ñ‹Ð¹ ÑˆÐ°Ð³ ÑÐ´ÐµÐ»Ð°Ð½! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ - Ð½Ðµ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒÑÑ!'
        ],
        7: [
          'ÐÐµÐ´ÐµÐ»Ñ Ð±ÐµÐ· Ð²Ñ€ÐµÐ´Ð½Ð¾Ð¹ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸! Ð¢Ñ‹ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð¸Ð¹ Ð³ÐµÑ€Ð¾Ð¹! Ð‘Ð°Ð±ÑƒÑˆÐºÐ° Ñ‚Ð°Ðº Ñ€Ð°Ð´Ð°!',
          'Ð¦ÐµÐ»ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ! Ð­Ñ‚Ð¾ ÑƒÐ¶Ðµ ÑÐµÑ€ÑŒÐµÐ·Ð½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚, Ð´Ð¾Ñ€Ð¾Ð³Ð¾Ð¹ Ð¼Ð¾Ð¹!'
        ],
        30: [
          'ÐœÐµÑÑÑ†! Ð¦ÐµÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ†! Ð¯ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ñ‹ Ð¼Ð¾Ð»Ð¾Ð´ÐµÑ†!',
          '30 Ð´Ð½ÐµÐ¹ - ÑÑ‚Ð¾ ÑƒÐ¶Ðµ Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ°, ÑÑ‚Ð¾ Ð¾Ð±Ñ€Ð°Ð· Ð¶Ð¸Ð·Ð½Ð¸! Ð“Ð¾Ñ€Ð¶ÑƒÑÑŒ!'
        ],
        100: [
          '100 Ð´Ð½ÐµÐ¹! Ð’Ð½ÑƒÑ‡ÐµÐº, Ñ‚Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ñ‹Ð¹! Ð­Ñ‚Ð¾ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð¸Ð¹ Ð¿Ð¾Ð´Ð²Ð¸Ð³!',
          'Ð¡Ñ‚Ð¾ Ð´Ð½ÐµÐ¹! Ð‘Ð°Ð±ÑƒÑˆÐºÐ° Ð¿Ð»Ð°Ñ‡ÐµÑ‚ Ð¾Ñ‚ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸! Ð¢Ñ‹ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹!'
        ]
      },
      streak: {
        3: [
          'Ð¢Ñ€Ð¸ Ð´Ð½Ñ Ð¿Ð¾Ð´Ñ€ÑÐ´! Ð¢Ñ‹ Ð½Ð°Ð±Ð¸Ñ€Ð°ÐµÑˆÑŒ Ð¾Ð±Ð¾Ñ€Ð¾Ñ‚Ñ‹, Ñ€Ð¾Ð´Ð½Ð¾Ð¹!',
          'Ð£Ð¶Ðµ Ñ‚Ñ€ÐµÑ‚Ð¸Ð¹ Ð´ÐµÐ½ÑŒ! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ñ‚Ð°Ðº Ð¶Ðµ!'
        ],
        7: [
          'ÐÐµÐ´ÐµÐ»Ñ Ð¿Ð¾Ð´Ñ€ÑÐ´! Ð­Ñ‚Ð¾ ÑƒÐ¶Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°, Ð²Ð½ÑƒÑ‡ÐµÐº!',
          'Ð¡ÐµÐ¼ÑŒ Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²Ð°! Ð¢Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼Ð¾Ð»Ð¾Ð´ÐµÑ†!'
        ],
        30: [
          'ÐœÐµÑÑÑ† Ð¿Ð¾Ð´Ñ€ÑÐ´! Ð­Ñ‚Ð¾ Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾!',
          '30 Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ - ÑÑ‚Ð¾ ÑƒÐ¶Ðµ Ð¼Ð°ÑÑ‚ÐµÑ€ÑÑ‚Ð²Ð¾!'
        ]
      },
      encouragement: [
        'Ð•ÑÐ»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð»Ð¾ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ - ÑÑ‚Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾. Ð—Ð°Ð²Ñ‚Ñ€Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð»ÐµÐ³Ñ‡Ðµ, Ñ Ð¾Ð±ÐµÑ‰Ð°ÑŽ!',
        'ÐŸÐ¾Ð¼Ð½Ð¸, Ñ‡Ñ‚Ð¾ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ - ÑÑ‚Ð¾ Ð½Ð¾Ð²Ð°Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð·Ð°Ð½Ð¾Ð²Ð¾!',
        'Ð¢Ñ‹ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ, Ñ‡ÐµÐ¼ Ð´ÑƒÐ¼Ð°ÐµÑˆÑŒ! Ð¯ Ð²ÐµÑ€ÑŽ Ð² Ñ‚ÐµÐ±Ñ!',
        'ÐÐµ ÑÐ´Ð°Ð²Ð°Ð¹ÑÑ, Ð´Ð¾Ñ€Ð¾Ð³Ð¾Ð¹! Ð‘Ð°Ð±ÑƒÑˆÐºÐ° Ð²ÑÐµÐ³Ð´Ð° Ñ€ÑÐ´Ð¾Ð¼!'
      ],
      achievement: [
        'Ð¢Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! ÐšÐ°ÐºÐ¾Ð¹ Ñ‚Ñ‹ Ð¼Ð¾Ð»Ð¾Ð´ÐµÑ†!',
        'ÐÐ¾Ð²Ð¾Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! Ð¯ Ñ‚Ð°Ðº Ð³Ð¾Ñ€Ð¶ÑƒÑÑŒ Ñ‚Ð¾Ð±Ð¾Ð¹!',
        'Ð¢Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð» ÑÑ‚Ð¾ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ð´ÑƒÑ…Ðµ!'
      ]
    }
  },
  gopnik: {
    id: 'gopnik',
    name: 'Ð“Ð¾Ð¿Ð½Ð¸Ðº',
    icon: 'ðŸ‘¨â€ðŸ’¼',
    phrases: {
      daily: [
        'Ð‘Ñ€Ð°Ñ‚Ð°Ð½, Ñ‚Ñ‹ ÐºÑ€Ð°ÑÐ°Ð²Ñ‡Ð¸Ðº! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ð´ÑƒÑ…Ðµ!',
        'Ð ÐµÑÐ¿ÐµÐºÑ‚ Ñ‚ÐµÐ±Ðµ, Ð±Ñ€Ð¾! ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ - ÑÑ‚Ð¾ Ð¿Ð¾Ð±ÐµÐ´Ð°!',
        'Ð¢Ñ‹ Ð´ÐµÐ»Ð°ÐµÑˆÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾, Ð¿Ð°Ñ†Ð°Ð½! Ð¢Ð°Ðº Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ!',
        'Ð¡Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ…Ð¾Ð´, Ð±Ñ€Ð°Ñ‚Ð¸ÑˆÐºÐ°! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹!',
        'Ð£Ð²Ð°Ð¶ÑƒÑ…Ð°! Ð¢Ñ‹ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ð¿ÑƒÑ‚Ð¸!'
      ],
      milestones: {
        1: [
          'ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ - Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð¿ÑƒÑ‚Ð¸, Ð±Ñ€Ð°Ñ‚Ð°Ð½! ÐÐµ ÑÐ´Ð°Ð²Ð°Ð¹ÑÑ!',
          'ÐŸÐµÑ€Ð²Ñ‹Ð¹ ÑˆÐ°Ð³ ÑÐ´ÐµÐ»Ð°Ð½! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ - Ð½Ðµ Ð»Ð¾Ð¼Ð°Ñ‚ÑŒÑÑ!'
        ],
        7: [
          'ÐÐµÐ´ÐµÐ»Ñ Ð±ÐµÐ· ÑÑ‚Ð¾Ð¹ Ñ„Ð¸Ð³Ð½Ð¸! Ð¢Ñ‹ ÐºÑ€Ð°ÑÐ°Ð²Ñ‡Ð¸Ðº, Ð±Ñ€Ð¾!',
          'Ð¦ÐµÐ»ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ Ð´ÐµÑ€Ð¶Ð¸ÑˆÑŒÑÑ! Ð ÐµÑÐ¿ÐµÐºÑ‚ Ð¸ ÑƒÐ²Ð°Ð¶ÑƒÑ…Ð°!'
        ],
        30: [
          'ÐœÐµÑÑÑ†! ÐœÐµÑÑÑ†, ÐšÐ°Ñ€Ð»! Ð¢Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð²ÐµÑ€ÑŒ!',
          '30 Ð´Ð½ÐµÐ¹ - ÑÑ‚Ð¾ ÑƒÐ¶Ðµ Ð½Ðµ ÑˆÑƒÑ‚ÐºÐ¸, Ð¿Ð°Ñ†Ð°Ð½! Ð¢Ñ‹ ÐºÑ€ÑƒÑ‚!'
        ],
        100: [
          '100 Ð´Ð½ÐµÐ¹! Ð‘Ñ€Ð°Ñ‚Ð°Ð½, Ñ‚Ñ‹ Ð»ÐµÐ³ÐµÐ½Ð´Ð°! Ð­Ñ‚Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½ÐµÑ€ÐµÐ°Ð»ÑŒÐ½Ð¾!',
          'Ð¡Ñ‚Ð¾ Ð´Ð½ÐµÐ¹! Ð¢Ñ‹ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð¸Ð¹ Ð±Ð¾ÐµÑ†! Ð ÐµÑÐ¿ÐµÐºÑ‚!'
        ]
      },
      streak: {
        3: [
          'Ð¢Ñ€Ð¸ Ð´Ð½Ñ Ð¿Ð¾Ð´Ñ€ÑÐ´! ÐÐ°Ð±Ð¸Ñ€Ð°ÐµÑˆÑŒ Ð¾Ð±Ð¾Ñ€Ð¾Ñ‚Ñ‹, Ð±Ñ€Ð°Ñ‚Ð°Ð½!',
          'Ð£Ð¶Ðµ Ñ‚Ñ€ÐµÑ‚Ð¸Ð¹ Ð´ÐµÐ½ÑŒ! Ð¢Ð°Ðº Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ, Ð¿Ð°Ñ†Ð°Ð½!'
        ],
        7: [
          'ÐÐµÐ´ÐµÐ»Ñ Ð¿Ð¾Ð´Ñ€ÑÐ´! Ð­Ñ‚Ð¾ ÑƒÐ¶Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°, Ð±Ñ€Ð¾!',
          'Ð¡ÐµÐ¼ÑŒ Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²Ð°! Ð¢Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð²ÐµÑ€ÑŒ!'
        ],
        30: [
          'ÐœÐµÑÑÑ† Ð¿Ð¾Ð´Ñ€ÑÐ´! Ð­Ñ‚Ð¾ Ð½ÐµÑ€ÐµÐ°Ð»ÑŒÐ½Ð¾, Ð±Ñ€Ð°Ñ‚Ð°Ð½!',
          '30 Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ - ÑÑ‚Ð¾ ÑƒÐ¶Ðµ Ð¼Ð°ÑÑ‚ÐµÑ€ÑÑ‚Ð²Ð¾, Ð¿Ð°Ñ†Ð°Ð½!'
        ]
      },
      encouragement: [
        'Ð•ÑÐ»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð»Ð¾ Ñ‚ÑÐ¶ÐµÐ»Ð¾ - Ð½Ðµ Ð¿Ð°Ñ€ÑŒÑÑ, Ð±Ñ€Ð°Ñ‚Ð°Ð½! Ð—Ð°Ð²Ñ‚Ñ€Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð»ÐµÐ³Ñ‡Ðµ!',
        'ÐŸÐ¾Ð¼Ð½Ð¸, Ñ‡Ñ‚Ð¾ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ - ÑÑ‚Ð¾ Ð½Ð¾Ð²Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ°! ÐÐµ ÑÐ´Ð°Ð²Ð°Ð¹ÑÑ!',
        'Ð¢Ñ‹ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ, Ñ‡ÐµÐ¼ Ð´ÑƒÐ¼Ð°ÐµÑˆÑŒ, Ð¿Ð°Ñ†Ð°Ð½! Ð¯ Ð² Ñ‚ÐµÐ±Ñ Ð²ÐµÑ€ÑŽ!',
        'ÐÐµ Ð»Ð¾Ð¼Ð°Ð¹ÑÑ, Ð±Ñ€Ð¾! Ð¢Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð¸ÑˆÑŒÑÑ!'
      ],
      achievement: [
        'Ð¢Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! ÐšÑ€Ð°ÑÐ°Ð²Ñ‡Ð¸Ðº, Ð±Ñ€Ð°Ñ‚Ð°Ð½!',
        'ÐÐ¾Ð²Ð¾Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! Ð ÐµÑÐ¿ÐµÐºÑ‚ Ñ‚ÐµÐ±Ðµ, Ð¿Ð°Ñ†Ð°Ð½!',
        'Ð¢Ñ‹ Ð·Ð°ÑÐ»ÑƒÐ¶Ð¸Ð» ÑÑ‚Ð¾ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹ Ñ‚Ð°Ðº Ð¶Ðµ!'
      ]
    }
  }
}

export function getCharacterMessage(
  characterType: CharacterType,
  habit: Habit,
  context: 'daily' | 'milestone' | 'streak' | 'encouragement' | 'achievement'
): string {
  const character = characters[characterType]
  const daysCount = habit.markedDays.length
  const streak = calculateStreak(habit.markedDays)

  let phrases: string[] = []

  switch (context) {
    case 'milestone':
      const milestone = getMilestone(daysCount)
      if (milestone && character.phrases.milestones[milestone]) {
        phrases = character.phrases.milestones[milestone]
      } else {
        phrases = character.phrases.daily
      }
      break
    case 'streak':
      const streakMilestone = getStreakMilestone(streak)
      if (streakMilestone && character.phrases.streak[streakMilestone]) {
        phrases = character.phrases.streak[streakMilestone]
      } else {
        phrases = character.phrases.daily
      }
      break
    default:
      phrases = character.phrases[context] || character.phrases.daily
  }

  return phrases[Math.floor(Math.random() * phrases.length)]
}

function calculateStreak(markedDays: string[]): number {
  if (markedDays.length === 0) return 0

  const sorted = [...markedDays].sort((a, b) => b.localeCompare(a))
  let streak = 0
  const today = new Date()
  today.setHours(0, 0, 0, 0)

  for (let i = 0; i < sorted.length; i++) {
    const date = new Date(sorted[i])
    date.setHours(0, 0, 0, 0)
    const expectedDate = new Date(today)
    expectedDate.setDate(today.getDate() - i)

    if (date.getTime() === expectedDate.getTime()) {
      streak++
    } else {
      break
    }
  }

  return streak
}

function getMilestone(days: number): number | null {
  if (days === 1) return 1
  if (days === 7) return 7
  if (days === 30) return 30
  if (days === 100) return 100
  return null
}

function getStreakMilestone(streak: number): number | null {
  if (streak >= 30) return 30
  if (streak >= 7) return 7
  if (streak >= 3) return 3
  return null
}

export function getCurrentStreak(habit: Habit): number {
  if (habit.markedDays.length === 0) return 0

  const sorted = [...habit.markedDays].sort((a, b) => b.localeCompare(a))
  let streak = 0
  const today = new Date()
  today.setHours(0, 0, 0, 0)

  for (let i = 0; i < sorted.length; i++) {
    const date = new Date(sorted[i])
    date.setHours(0, 0, 0, 0)
    const expectedDate = new Date(today)
    expectedDate.setDate(today.getDate() - i)

    if (date.getTime() === expectedDate.getTime()) {
      streak++
    } else {
      break
    }
  }

  return streak
}

