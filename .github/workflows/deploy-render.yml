name: Deploy to Render.com

on:
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  push:
    branches:
      - main
    paths:
      - 'server/**'
      - 'render.yaml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check server files
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞..."
          ls -la server/
          test -f server/package.json && echo "‚úÖ package.json –Ω–∞–π–¥–µ–Ω" || exit 1
          test -f server/server.js && echo "‚úÖ server.js –Ω–∞–π–¥–µ–Ω" || exit 1
          test -f server/bot.js && echo "‚úÖ bot.js –Ω–∞–π–¥–µ–Ω" || exit 1
          test -f render.yaml && echo "‚úÖ render.yaml –Ω–∞–π–¥–µ–Ω" || echo "‚ö†Ô∏è render.yaml –Ω–µ –Ω–∞–π–¥–µ–Ω"

      - name: Verify server configuration
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
          if grep -q "TELEGRAM_BOT_TOKEN" server/server.js; then
            echo "‚úÖ –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–¥–µ"
          else
            echo "‚ö†Ô∏è –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è)"
          fi

      - name: Deployment instructions
        run: |
          echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é:"
          echo ""
          echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ https://dashboard.render.com"
          echo "2. –ù–∞–∂–º–∏—Ç–µ 'New +' ‚Üí 'Web Service'"
          echo "3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: Tilkerman/project-pwa"
          echo "4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:"
          echo "   - Name: habit-tracker-notifications"
          echo "   - Root Directory: server"
          echo "   - Build Command: npm install"
          echo "   - Start Command: npm start"
          echo "   - Environment Variable: TELEGRAM_BOT_TOKEN = 7985172630:AAFTN9xGM2C-s0ni07VHOcCCZiyL3XbDh4o"
          echo "5. –ù–∞–∂–º–∏—Ç–µ 'Create Web Service'"
          echo ""
          echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é!"

