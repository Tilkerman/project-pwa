# Настройка уведомлений для работы в фоне

## Важно для работы уведомлений в фоне:

### 1. Разрешения браузера
- Убедитесь, что вы дали разрешение на уведомления браузеру
- На Android: разрешения запрашиваются автоматически при первом включении уведомлений

### 2. Установка PWA
- **Обязательно установите приложение как PWA** (Add to Home Screen)
- Это необходимо для работы Service Worker в фоне
- Без установки PWA уведомления будут работать только когда приложение открыто

### 3. Настройки браузера (Android Chrome)
- Перейдите в настройки Chrome → Сайты → [Ваш сайт]
- Убедитесь, что включены:
  - Уведомления
  - Фоновая синхронизация (если доступна)

### 4. Настройки системы (Android)
- Настройки → Приложения → [Ваш браузер] → Уведомления
- Убедитесь, что уведомления включены для браузера
- Проверьте, что приложение не находится в режиме энергосбережения

### 5. Тестирование
1. Установите приложение как PWA
2. Включите уведомления для одной из привычек
3. Поставьте время на 2-3 минуты вперед от текущего
4. Закройте приложение полностью
5. Заблокируйте экран
6. Дождитесь времени уведомления

## Как работает система уведомлений:

### Когда приложение открыто:
- Используется точный `setTimeout` для показа уведомления в нужное время
- Работает с точностью до секунды

### Когда приложение закрыто или экран заблокирован:
- Service Worker проверяет время каждые 30 секунд
- Используется Periodic Background Sync (на поддерживающих устройствах)
- Уведомления показываются с точностью до минуты

## Поддержка браузеров:

- ✅ **Android Chrome** - полная поддержка фоновых уведомлений
- ⚠️ **iOS Safari** - ограниченная поддержка (см. раздел ниже)
- ✅ **Desktop Chrome/Edge** - полная поддержка
- ⚠️ **Firefox** - ограниченная поддержка фоновых уведомлений

## ⚠️ Особенности iOS:

На iOS Safari уведомления имеют серьезные ограничения из-за политики Apple:

### Что работает на iOS:
- ✅ Уведомления работают когда приложение открыто
- ✅ Уведомления показываются при открытии приложения (если были пропущены)
- ✅ Приложение проверяет пропущенные уведомления при каждом открытии

### Что НЕ работает на iOS:
- ❌ Фоновые уведомления при закрытом приложении (ограничение iOS)
- ❌ Уведомления при заблокированном экране (ограничение iOS)

### Решение для iOS:
1. **Установите приложение как PWA** (Add to Home Screen)
2. **Открывайте приложение регулярно** - оно автоматически проверит пропущенные уведомления
3. **Оставьте приложение открытым** - уведомления будут приходить вовремя

### Почему это происходит?
iOS Safari не позволяет Service Worker работать в фоне без сервера и Push Notifications API. Это ограничение безопасности Apple, которое нельзя обойти без серверной части приложения.

## Устранение проблем:

Если уведомления не работают в фоне:

1. Переустановите PWA (удалите и добавьте снова)
2. Проверьте разрешения браузера
3. Убедитесь, что приложение установлено как PWA
4. Проверьте настройки энергосбережения устройства
5. Перезагрузите устройство

